{"version":3,"sources":["../../../../node_modules/next/src/server/route-modules/app-page/module.compiled.js","../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-runtime.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/ssr/react.ts","../../../../app/lib/auth-context.js","../../../../app/lib/api.js"],"sourcesContent":["if (process.env.NEXT_RUNTIME === 'edge') {\n  module.exports = require('next/dist/server/route-modules/app-page/module.js')\n} else {\n  if (process.env.__NEXT_EXPERIMENTAL_REACT) {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.prod.js')\n      }\n    }\n  } else {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.prod.js')\n      }\n    }\n  }\n}\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactJsxRuntime\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.React\n","\"use client\";\n\nimport { createContext, useContext, useEffect, useState, useCallback } from \"react\";\nimport { apiFetch } from \"./api\";\n\nconst AuthContext = createContext(null);\n\nexport function AuthProvider({ children }) {\n  const [user, setUser] = useState(null);\n  const [token, setToken] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  // Restore token from localStorage on mount\n  useEffect(() => {\n    const stored = localStorage.getItem(\"synthesis_token\");\n    if (stored) {\n      setToken(stored);\n    } else {\n      setLoading(false);\n    }\n  }, []);\n\n  // Whenever token changes, try to fetch the current user\n  useEffect(() => {\n    if (!token) {\n      setUser(null);\n      setLoading(false);\n      return;\n    }\n\n    let ignore = false;\n\n    async function loadUser() {\n      try {\n        const data = await apiFetch(\"/api/auth/me\", {}, token);\n        if (!ignore) setUser(data.user);\n      } catch {\n        if (!ignore) {\n          setUser(null);\n          setToken(null);\n          localStorage.removeItem(\"synthesis_token\");\n        }\n      } finally {\n        if (!ignore) setLoading(false);\n      }\n    }\n\n    loadUser();\n    return () => { ignore = true; };\n  }, [token]);\n\n  const login = useCallback(async (email, password) => {\n    const data = await apiFetch(\"/api/auth/login\", {\n      method: \"POST\",\n      body: JSON.stringify({ email, password }),\n    });\n    localStorage.setItem(\"synthesis_token\", data.token);\n    setToken(data.token);\n    setUser(data.user);\n    return data.user;\n  }, []);\n\n  const register = useCallback(async (email, password, name) => {\n    const data = await apiFetch(\"/api/auth/register\", {\n      method: \"POST\",\n      body: JSON.stringify({ email, password, name }),\n    });\n    localStorage.setItem(\"synthesis_token\", data.token);\n    setToken(data.token);\n    setUser(data.user);\n    return data.user;\n  }, []);\n\n  const logout = useCallback(async () => {\n    try {\n      await apiFetch(\"/api/auth/logout\", { method: \"POST\" }, token);\n    } catch {\n      // ignore\n    }\n    localStorage.removeItem(\"synthesis_token\");\n    setToken(null);\n    setUser(null);\n  }, [token]);\n\n  return (\n    <AuthContext.Provider value={{ user, token, loading, login, register, logout }}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  const ctx = useContext(AuthContext);\n  if (!ctx) throw new Error(\"useAuth must be used within AuthProvider\");\n  return ctx;\n}\n","const API_BASE = process.env.NEXT_PUBLIC_API_BASE || \"\";\n\nexport async function apiFetch(path, options = {}, token) {\n  const url = `${API_BASE}${path}`;\n  const headers = {\n    \"Content-Type\": \"application/json\",\n    ...(options.headers || {}),\n  };\n\n  if (token) {\n    headers.Authorization = `Bearer ${token}`;\n  }\n\n  const res = await fetch(url, {\n    ...options,\n    headers,\n    credentials: \"include\",\n  });\n\n  const contentType = res.headers.get(\"content-type\") || \"\";\n  const isJson = contentType.includes(\"application/json\");\n  const payload = isJson ? await res.json() : await res.text();\n\n  if (!res.ok) {\n    const message = payload?.error || payload || \"Request failed\";\n    throw new Error(message);\n  }\n\n  return payload;\n}\n"],"names":["process","env","NEXT_RUNTIME","module","exports","require","__NEXT_EXPERIMENTAL_REACT","NODE_ENV","TURBOPACK","vendored","ReactJsxRuntime","React"],"mappings":"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","ignoreList":[0,1,2]}