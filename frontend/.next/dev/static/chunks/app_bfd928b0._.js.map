{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/laphatize/Documents/synthesis/frontend/app/lib/use-arxiv.js"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect, useRef, useCallback } from \"react\";\nimport { apiFetch } from \"./api\";\n\n/**\n * Extracts meaningful keywords from editor plain text.\n * Strips very short / common words, returns top terms by frequency.\n */\nfunction extractQuery(text, maxWords = 6) {\n  const stop = new Set([\n    \"the\", \"a\", \"an\", \"and\", \"or\", \"but\", \"is\", \"are\", \"was\", \"were\",\n    \"be\", \"been\", \"being\", \"have\", \"has\", \"had\", \"do\", \"does\", \"did\",\n    \"will\", \"would\", \"shall\", \"should\", \"may\", \"might\", \"must\", \"can\",\n    \"could\", \"to\", \"of\", \"in\", \"for\", \"on\", \"with\", \"at\", \"by\", \"from\",\n    \"as\", \"into\", \"through\", \"during\", \"before\", \"after\", \"above\",\n    \"below\", \"between\", \"out\", \"off\", \"over\", \"under\", \"again\", \"further\",\n    \"then\", \"once\", \"here\", \"there\", \"when\", \"where\", \"why\", \"how\", \"all\",\n    \"each\", \"every\", \"both\", \"few\", \"more\", \"most\", \"other\", \"some\",\n    \"such\", \"no\", \"nor\", \"not\", \"only\", \"own\", \"same\", \"so\", \"than\",\n    \"too\", \"very\", \"just\", \"because\", \"if\", \"about\", \"up\", \"its\", \"it\",\n    \"this\", \"that\", \"these\", \"those\", \"i\", \"we\", \"you\", \"he\", \"she\",\n    \"they\", \"me\", \"him\", \"her\", \"us\", \"them\", \"my\", \"your\", \"his\",\n    \"our\", \"their\", \"what\", \"which\", \"who\", \"whom\", \"while\", \"also\",\n    \"new\", \"one\", \"two\", \"like\", \"get\", \"make\", \"go\", \"know\", \"take\",\n    \"see\", \"come\", \"think\", \"look\", \"want\", \"give\", \"use\", \"find\",\n    \"tell\", \"ask\", \"work\", \"seem\", \"feel\", \"try\", \"leave\", \"call\",\n  ]);\n\n  const words = text\n    .toLowerCase()\n    .replace(/[^a-z0-9\\s-]/g, \" \")\n    .split(/\\s+/)\n    .filter((w) => w.length > 2 && !stop.has(w));\n\n  // Frequency count\n  const freq = {};\n  for (const w of words) {\n    freq[w] = (freq[w] || 0) + 1;\n  }\n\n  return Object.entries(freq)\n    .sort((a, b) => b[1] - a[1])\n    .slice(0, maxWords)\n    .map(([w]) => w)\n    .join(\" \");\n}\n\n/**\n * Hook: watches editor plain text, debounces, queries ArXiv.\n * Returns { papers, loading, query }\n */\nexport function useArxivSuggestions(plainText, { delay = 2000, minLength = 30 } = {}) {\n  const [papers, setPapers] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [query, setQuery] = useState(\"\");\n  const timerRef = useRef(null);\n  const lastQueryRef = useRef(\"\");\n  const abortRef = useRef(null);\n\n  const search = useCallback(async (q) => {\n    if (!q || q === lastQueryRef.current) return;\n    lastQueryRef.current = q;\n    setQuery(q);\n    setLoading(true);\n\n    // Abort any in-flight request\n    if (abortRef.current) abortRef.current.abort();\n    const controller = new AbortController();\n    abortRef.current = controller;\n\n    try {\n      const data = await apiFetch(`/api/arxiv/search?q=${encodeURIComponent(q)}&max=6`);\n      if (!controller.signal.aborted) {\n        setPapers(data.papers || []);\n      }\n    } catch {\n      if (!controller.signal.aborted) setPapers([]);\n    } finally {\n      if (!controller.signal.aborted) setLoading(false);\n    }\n  }, []);\n\n  useEffect(() => {\n    clearTimeout(timerRef.current);\n\n    if (!plainText || plainText.length < minLength) {\n      setPapers([]);\n      setQuery(\"\");\n      return;\n    }\n\n    timerRef.current = setTimeout(() => {\n      const q = extractQuery(plainText);\n      if (q.trim()) search(q);\n    }, delay);\n\n    return () => clearTimeout(timerRef.current);\n  }, [plainText, delay, minLength, search]);\n\n  return { papers, loading, query };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 234, "column": 0}, "map": {"version":3,"sources":["file:///Users/laphatize/Documents/synthesis/frontend/app/components/AIBubbleMenu.js"],"sourcesContent":["\"use client\";\n\nimport { useState, useCallback, useEffect, useRef } from \"react\";\nimport { apiFetch } from \"../lib/api\";\n\nconst ACTIONS = [\n  { key: \"explore\", label: \"ðŸ” Explore further\" },\n  { key: \"elaborate\", label: \"ðŸ“ Elaborate\" },\n  { key: \"simplify\", label: \"âœï¸ Simplify\" },\n  { key: \"shorten\", label: \"âœ‚ï¸ Shorten\" },\n  { key: \"academic\", label: \"ðŸŽ“ Academic tone\" },\n  { key: \"counterargument\", label: \"âš–ï¸ Counter-argument\" },\n];\n\nexport default function AIBubbleMenu({ editor }) {\n  const [visible, setVisible] = useState(false);\n  const [pos, setPos] = useState({ top: 0, left: 0 });\n  const [loading, setLoading] = useState(false);\n  const [activeAction, setActiveAction] = useState(null);\n  const menuRef = useRef(null);\n\n  useEffect(() => {\n    if (!editor) return;\n\n    const update = () => {\n      const { from, to } = editor.state.selection;\n      const text = editor.state.doc.textBetween(from, to, \" \");\n\n      if (from === to || text.trim().length < 3 || editor.isActive(\"codeBlock\")) {\n        setVisible(false);\n        return;\n      }\n\n      // Get coordinates of selection\n      const coords = editor.view.coordsAtPos(from);\n      const editorRect = editor.view.dom.closest(\".flex-1.overflow-y-auto\")?.getBoundingClientRect();\n      if (!editorRect) { setVisible(false); return; }\n\n      setPos({\n        top: coords.top - editorRect.top - 48,\n        left: coords.left - editorRect.left,\n      });\n      setVisible(true);\n    };\n\n    editor.on(\"selectionUpdate\", update);\n    editor.on(\"blur\", () => {\n      // Delay to allow button clicks\n      setTimeout(() => {\n        if (!menuRef.current?.contains(document.activeElement)) {\n          setVisible(false);\n        }\n      }, 200);\n    });\n\n    return () => {\n      editor.off(\"selectionUpdate\", update);\n    };\n  }, [editor]);\n\n  const handleAction = useCallback(\n    async (action) => {\n      const { from, to } = editor.state.selection;\n      const selectedText = editor.state.doc.textBetween(from, to, \" \");\n      if (!selectedText.trim()) return;\n\n      setLoading(true);\n      setActiveAction(action);\n\n      try {\n        const fullText = editor.getText();\n        const data = await apiFetch(\"/api/arxiv/transform\", {\n          method: \"POST\",\n          body: JSON.stringify({\n            text: selectedText,\n            action,\n            context: fullText,\n          }),\n        });\n\n        if (data.result) {\n          editor\n            .chain()\n            .focus()\n            .deleteRange({ from, to })\n            .insertContentAt(from, data.result)\n            .run();\n        }\n      } catch (err) {\n        console.error(\"AI transform failed:\", err.message);\n      } finally {\n        setLoading(false);\n        setActiveAction(null);\n        setVisible(false);\n      }\n    },\n    [editor]\n  );\n\n  if (!visible && !loading) return null;\n\n  return (\n    <div\n      ref={menuRef}\n      className=\"ai-bubble-menu\"\n      style={{\n        position: \"absolute\",\n        top: pos.top,\n        left: pos.left,\n        zIndex: 50,\n        transform: \"translateX(-25%)\",\n      }}\n    >\n      {loading ? (\n        <div className=\"ai-bubble-loading\">\n          <span className=\"papers-loader\" />\n          <span className=\"text-[11px] text-[var(--muted)]\">\n            {ACTIONS.find((a) => a.key === activeAction)?.label.replace(/^.+?\\s/, \"\")}â€¦\n          </span>\n        </div>\n      ) : (\n        <div className=\"ai-bubble-actions\">\n          {ACTIONS.map((a) => (\n            <button\n              key={a.key}\n              onMouseDown={(e) => e.preventDefault()}\n              onClick={() => handleAction(a.key)}\n              className=\"ai-bubble-btn\"\n            >\n              {a.label}\n            </button>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 434, "column": 0}, "map": {"version":3,"sources":["file:///Users/laphatize/Documents/synthesis/frontend/app/components/Editor.js"],"sourcesContent":["\"use client\";\n\nimport { useEditor, EditorContent } from \"@tiptap/react\";\nimport StarterKit from \"@tiptap/starter-kit\";\nimport Placeholder from \"@tiptap/extension-placeholder\";\nimport Typography from \"@tiptap/extension-typography\";\nimport { useEffect, useRef } from \"react\";\nimport AIBubbleMenu from \"./AIBubbleMenu\";\n\nexport default function Editor({ content, onUpdate, onTextChange, placeholder = \"Start writingâ€¦\" }) {\n  const debounceRef = useRef(null);\n\n  const editor = useEditor({\n    immediatelyRender: false,\n    extensions: [\n      StarterKit.configure({\n        heading: { levels: [1, 2, 3] },\n        codeBlock: { HTMLAttributes: { class: \"code-block\" } },\n      }),\n      Placeholder.configure({ placeholder }),\n      Typography,\n    ],\n    content: content || \"\",\n    editorProps: {\n      attributes: {\n        class: \"tiptap\",\n      },\n    },\n    onUpdate: ({ editor }) => {\n      if (!onUpdate) return;\n      // Debounce saves\n      clearTimeout(debounceRef.current);\n      debounceRef.current = setTimeout(() => {\n        onUpdate(editor.getHTML());\n      }, 500);\n      // Plain text for AI features (immediate)\n      if (onTextChange) onTextChange(editor.getText());\n    },\n  });\n\n  // Sync external content changes (e.g. loading a different doc)\n  useEffect(() => {\n    if (editor && content !== undefined && editor.getHTML() !== content) {\n      editor.commands.setContent(content || \"\");\n    }\n  }, [content, editor]);\n\n  if (!editor) return null;\n\n  return (\n    <div className=\"flex flex-1 flex-col\">\n      {/* Minimal toolbar */}\n      <div className=\"flex items-center gap-0.5 border-b border-[var(--border)] px-1 py-1\">\n        <ToolBtn\n          active={editor.isActive(\"bold\")}\n          onClick={() => editor.chain().focus().toggleBold().run()}\n          label=\"B\"\n          className=\"font-bold\"\n        />\n        <ToolBtn\n          active={editor.isActive(\"italic\")}\n          onClick={() => editor.chain().focus().toggleItalic().run()}\n          label=\"I\"\n          className=\"italic\"\n        />\n        <ToolBtn\n          active={editor.isActive(\"strike\")}\n          onClick={() => editor.chain().focus().toggleStrike().run()}\n          label=\"S\"\n          className=\"line-through\"\n        />\n        <Sep />\n        <ToolBtn\n          active={editor.isActive(\"heading\", { level: 1 })}\n          onClick={() => editor.chain().focus().toggleHeading({ level: 1 }).run()}\n          label=\"H1\"\n        />\n        <ToolBtn\n          active={editor.isActive(\"heading\", { level: 2 })}\n          onClick={() => editor.chain().focus().toggleHeading({ level: 2 }).run()}\n          label=\"H2\"\n        />\n        <ToolBtn\n          active={editor.isActive(\"heading\", { level: 3 })}\n          onClick={() => editor.chain().focus().toggleHeading({ level: 3 }).run()}\n          label=\"H3\"\n        />\n        <Sep />\n        <ToolBtn\n          active={editor.isActive(\"bulletList\")}\n          onClick={() => editor.chain().focus().toggleBulletList().run()}\n          label=\"â€¢\"\n        />\n        <ToolBtn\n          active={editor.isActive(\"orderedList\")}\n          onClick={() => editor.chain().focus().toggleOrderedList().run()}\n          label=\"1.\"\n        />\n        <ToolBtn\n          active={editor.isActive(\"blockquote\")}\n          onClick={() => editor.chain().focus().toggleBlockquote().run()}\n          label=\"â\"\n        />\n        <ToolBtn\n          active={editor.isActive(\"codeBlock\")}\n          onClick={() => editor.chain().focus().toggleCodeBlock().run()}\n          label=\"<>\"\n          className=\"font-mono text-[10px]\"\n        />\n        <Sep />\n        <ToolBtn\n          onClick={() => editor.chain().focus().setHorizontalRule().run()}\n          label=\"â€”\"\n        />\n      </div>\n\n      {/* Editor area */}\n      <div className=\"relative flex-1 overflow-y-auto px-6 py-4 sm:px-10 md:px-16 lg:px-24\">\n        <div className=\"mx-auto max-w-2xl\">\n          <AIBubbleMenu editor={editor} />\n          <EditorContent editor={editor} />\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction ToolBtn({ active, onClick, label, className = \"\" }) {\n  return (\n    <button\n      type=\"button\"\n      onMouseDown={(e) => e.preventDefault()}\n      onClick={onClick}\n      className={`rounded px-2 py-1 text-xs transition ${className} ${\n        active\n          ? \"bg-[var(--fg)] text-white\"\n          : \"text-[var(--muted)] hover:bg-[#f0f0f0] hover:text-[var(--fg)]\"\n      }`}\n    >\n      {label}\n    </button>\n  );\n}\n\nfunction Sep() {\n  return <div className=\"mx-1 h-4 w-px bg-[var(--border)]\" />;\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 731, "column": 0}, "map": {"version":3,"sources":["file:///Users/laphatize/Documents/synthesis/frontend/app/components/PaperModal.js"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect, useRef, useCallback } from \"react\";\nimport { apiFetch } from \"../lib/api\";\n\nexport default function PaperModal({ paper, userText, onClose }) {\n  const [tab, setTab] = useState(\"overview\"); // overview | suggestions | chat\n  const [suggestions, setSuggestions] = useState(\"\");\n  const [sugLoading, setSugLoading] = useState(false);\n  const [sugError, setSugError] = useState(\"\");\n\n  const [chatHistory, setChatHistory] = useState([]);\n  const [chatInput, setChatInput] = useState(\"\");\n  const [chatLoading, setChatLoading] = useState(false);\n  const chatEndRef = useRef(null);\n  const inputRef = useRef(null);\n\n  // Close on Escape\n  useEffect(() => {\n    function onKey(e) {\n      if (e.key === \"Escape\") onClose();\n    }\n    window.addEventListener(\"keydown\", onKey);\n    return () => window.removeEventListener(\"keydown\", onKey);\n  }, [onClose]);\n\n  // Auto-fetch suggestions when tab is selected\n  useEffect(() => {\n    if (tab === \"suggestions\" && !suggestions && !sugLoading) {\n      fetchSuggestions();\n    }\n  }, [tab]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  // Scroll chat to bottom\n  useEffect(() => {\n    chatEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  }, [chatHistory, chatLoading]);\n\n  // Focus input when switching to chat\n  useEffect(() => {\n    if (tab === \"chat\") inputRef.current?.focus();\n  }, [tab]);\n\n  const fetchSuggestions = useCallback(async () => {\n    setSugLoading(true);\n    setSugError(\"\");\n    try {\n      const data = await apiFetch(\"/api/arxiv/analyze\", {\n        method: \"POST\",\n        body: JSON.stringify({\n          paper: {\n            title: paper.title,\n            summary: paper.summary,\n            authors: paper.authors,\n          },\n          userText: userText || \"\",\n        }),\n      });\n      setSuggestions(data.suggestions);\n    } catch (err) {\n      setSugError(err.message);\n    } finally {\n      setSugLoading(false);\n    }\n  }, [paper, userText]);\n\n  async function sendChat(e) {\n    e?.preventDefault();\n    const msg = chatInput.trim();\n    if (!msg || chatLoading) return;\n\n    const newHistory = [...chatHistory, { role: \"user\", content: msg }];\n    setChatHistory(newHistory);\n    setChatInput(\"\");\n    setChatLoading(true);\n\n    try {\n      const data = await apiFetch(\"/api/arxiv/chat\", {\n        method: \"POST\",\n        body: JSON.stringify({\n          paper: {\n            title: paper.title,\n            summary: paper.summary,\n            authors: paper.authors,\n          },\n          history: newHistory.slice(-10),\n          message: msg,\n        }),\n      });\n      setChatHistory((prev) => [...prev, { role: \"assistant\", content: data.reply }]);\n    } catch (err) {\n      setChatHistory((prev) => [\n        ...prev,\n        { role: \"assistant\", content: `Error: ${err.message}` },\n      ]);\n    } finally {\n      setChatLoading(false);\n    }\n  }\n\n  return (\n    <div className=\"paper-modal-overlay\" onClick={onClose}>\n      <div className=\"paper-modal\" onClick={(e) => e.stopPropagation()}>\n        {/* Header */}\n        <div className=\"paper-modal-header\">\n          <div className=\"flex-1 min-w-0\">\n            <h2 className=\"text-sm font-semibold leading-snug pr-4\">{paper.title}</h2>\n            <p className=\"text-[11px] text-[var(--muted)] mt-1\">\n              {paper.authors?.join(\", \")}\n              {paper.authors?.length >= 4 && \" et al.\"}\n              {paper.published && <> Â· {paper.published}</>}\n            </p>\n          </div>\n          <button onClick={onClose} className=\"paper-modal-close\">âœ•</button>\n        </div>\n\n        {/* Tabs */}\n        <div className=\"paper-modal-tabs\">\n          {[\"overview\", \"suggestions\", \"chat\"].map((t) => (\n            <button\n              key={t}\n              onClick={() => setTab(t)}\n              className={`paper-modal-tab ${tab === t ? \"active\" : \"\"}`}\n            >\n              {t === \"overview\" && \"Overview\"}\n              {t === \"suggestions\" && \"âœ¨ Suggestions\"}\n              {t === \"chat\" && \"ðŸ’¬ Chat\"}\n            </button>\n          ))}\n        </div>\n\n        {/* Body */}\n        <div className=\"paper-modal-body\">\n          {/* â”€â”€â”€ Overview â”€â”€â”€ */}\n          {tab === \"overview\" && (\n            <div className=\"paper-modal-scroll\">\n              <div className=\"mb-4\">\n                <h3 className=\"text-xs font-semibold text-[var(--muted)] uppercase tracking-wider mb-2\">\n                  Abstract\n                </h3>\n                <p className=\"text-sm leading-relaxed\">{paper.summary}</p>\n              </div>\n\n              {paper.categories?.length > 0 && (\n                <div className=\"mb-4\">\n                  <h3 className=\"text-xs font-semibold text-[var(--muted)] uppercase tracking-wider mb-2\">\n                    Categories\n                  </h3>\n                  <div className=\"flex flex-wrap gap-1.5\">\n                    {paper.categories.map((cat) => (\n                      <span\n                        key={cat}\n                        className=\"text-[10px] px-2 py-0.5 rounded-full bg-[#f0f0f0] text-[var(--muted)]\"\n                      >\n                        {cat}\n                      </span>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              <div className=\"flex gap-3 mt-4\">\n                {paper.absUrl && (\n                  <a\n                    href={paper.absUrl}\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                    className=\"text-xs px-3 py-1.5 rounded border border-[var(--border)] text-[var(--fg)] hover:bg-[#f8f8f8] transition\"\n                  >\n                    View on ArXiv â†—\n                  </a>\n                )}\n                {paper.pdfUrl && (\n                  <a\n                    href={paper.pdfUrl}\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                    className=\"text-xs px-3 py-1.5 rounded border border-[var(--border)] text-[var(--fg)] hover:bg-[#f8f8f8] transition\"\n                  >\n                    PDF â†—\n                  </a>\n                )}\n              </div>\n            </div>\n          )}\n\n          {/* â”€â”€â”€ Suggestions â”€â”€â”€ */}\n          {tab === \"suggestions\" && (\n            <div className=\"paper-modal-scroll\">\n              {sugLoading ? (\n                <div className=\"flex items-center gap-2 py-8 justify-center\">\n                  <span className=\"papers-loader\" />\n                  <span className=\"text-xs text-[var(--muted)]\">\n                    Analyzing how this paper applies to your writingâ€¦\n                  </span>\n                </div>\n              ) : sugError ? (\n                <div className=\"py-8 text-center\">\n                  <p className=\"text-xs text-red-500 mb-2\">{sugError}</p>\n                  <button\n                    onClick={fetchSuggestions}\n                    className=\"text-xs text-[var(--fg)] underline\"\n                  >\n                    Retry\n                  </button>\n                </div>\n              ) : (\n                <div className=\"paper-markdown text-sm leading-relaxed\">\n                  <Markdown text={suggestions} />\n                </div>\n              )}\n            </div>\n          )}\n\n          {/* â”€â”€â”€ Chat â”€â”€â”€ */}\n          {tab === \"chat\" && (\n            <div className=\"flex flex-col h-full\">\n              <div className=\"paper-modal-scroll flex-1\">\n                {chatHistory.length === 0 && (\n                  <div className=\"py-8 text-center\">\n                    <p className=\"text-xs text-[var(--muted)]\">\n                      Ask anything about this paper.\n                    </p>\n                    <div className=\"flex flex-wrap gap-1.5 justify-center mt-3\">\n                      {[\n                        \"What methodology does this paper use?\",\n                        \"What are the key findings?\",\n                        \"What are the limitations?\",\n                        \"How does this compare to related work?\",\n                      ].map((q) => (\n                        <button\n                          key={q}\n                          onClick={() => {\n                            setChatInput(q);\n                            inputRef.current?.focus();\n                          }}\n                          className=\"text-[10px] px-2.5 py-1 rounded-full border border-[var(--border)] text-[var(--muted)] hover:text-[var(--fg)] hover:border-[var(--fg)] transition\"\n                        >\n                          {q}\n                        </button>\n                      ))}\n                    </div>\n                  </div>\n                )}\n\n                {chatHistory.map((msg, i) => (\n                  <div\n                    key={i}\n                    className={`paper-chat-msg ${msg.role === \"user\" ? \"user\" : \"assistant\"}`}\n                  >\n                    <div className=\"text-[10px] font-medium text-[var(--muted)] mb-0.5 uppercase tracking-wider\">\n                      {msg.role === \"user\" ? \"You\" : \"Synthesis\"}\n                    </div>\n                    <div className=\"paper-markdown text-sm leading-relaxed\">\n                      <Markdown text={msg.content} />\n                    </div>\n                  </div>\n                ))}\n\n                {chatLoading && (\n                  <div className=\"paper-chat-msg assistant\">\n                    <div className=\"text-[10px] font-medium text-[var(--muted)] mb-0.5 uppercase tracking-wider\">\n                      Synthesis\n                    </div>\n                    <span className=\"papers-loader\" />\n                  </div>\n                )}\n                <div ref={chatEndRef} />\n              </div>\n\n              {/* Input */}\n              <form onSubmit={sendChat} className=\"paper-chat-input-bar\">\n                <input\n                  ref={inputRef}\n                  type=\"text\"\n                  value={chatInput}\n                  onChange={(e) => setChatInput(e.target.value)}\n                  placeholder=\"Ask about this paperâ€¦\"\n                  className=\"flex-1 bg-transparent text-sm outline-none placeholder:text-[var(--muted)]\"\n                  disabled={chatLoading}\n                />\n                <button\n                  type=\"submit\"\n                  disabled={!chatInput.trim() || chatLoading}\n                  className=\"text-xs font-medium text-[var(--fg)] disabled:text-[var(--muted)] transition\"\n                >\n                  Send\n                </button>\n              </form>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\n/**\n * Simple markdown-to-JSX renderer.\n * Handles: headers, bold, italic, code, bullet lists, numbered lists, links.\n */\nfunction Markdown({ text }) {\n  if (!text) return null;\n\n  const lines = text.split(\"\\n\");\n  const elements = [];\n  let i = 0;\n\n  while (i < lines.length) {\n    const line = lines[i];\n\n    // Headers\n    if (line.startsWith(\"### \")) {\n      elements.push(<h4 key={i} className=\"font-semibold text-xs mt-3 mb-1\">{parseInline(line.slice(4))}</h4>);\n    } else if (line.startsWith(\"## \")) {\n      elements.push(<h3 key={i} className=\"font-semibold text-sm mt-3 mb-1\">{parseInline(line.slice(3))}</h3>);\n    } else if (line.startsWith(\"# \")) {\n      elements.push(<h2 key={i} className=\"font-bold text-base mt-3 mb-1\">{parseInline(line.slice(2))}</h2>);\n    }\n    // Bullet list\n    else if (/^[-*â€¢]\\s/.test(line)) {\n      const items = [];\n      while (i < lines.length && /^[-*â€¢]\\s/.test(lines[i])) {\n        items.push(lines[i].replace(/^[-*â€¢]\\s+/, \"\"));\n        i++;\n      }\n      elements.push(\n        <ul key={`ul-${i}`} className=\"list-disc pl-4 my-1.5 space-y-1\">\n          {items.map((item, j) => (\n            <li key={j}>{parseInline(item)}</li>\n          ))}\n        </ul>\n      );\n      continue;\n    }\n    // Numbered list\n    else if (/^\\d+[.)]\\s/.test(line)) {\n      const items = [];\n      while (i < lines.length && /^\\d+[.)]\\s/.test(lines[i])) {\n        items.push(lines[i].replace(/^\\d+[.)]\\s+/, \"\"));\n        i++;\n      }\n      elements.push(\n        <ol key={`ol-${i}`} className=\"list-decimal pl-4 my-1.5 space-y-1\">\n          {items.map((item, j) => (\n            <li key={j}>{parseInline(item)}</li>\n          ))}\n        </ol>\n      );\n      continue;\n    }\n    // Empty line\n    else if (line.trim() === \"\") {\n      // skip\n    }\n    // Paragraph\n    else {\n      elements.push(<p key={i} className=\"my-1\">{parseInline(line)}</p>);\n    }\n\n    i++;\n  }\n\n  return <>{elements}</>;\n}\n\nfunction parseInline(text) {\n  // Process: **bold**, *italic*, `code`, [links](url)\n  const parts = [];\n  let remaining = text;\n  let key = 0;\n\n  while (remaining.length > 0) {\n    // Bold\n    const boldMatch = remaining.match(/\\*\\*(.+?)\\*\\*/);\n    // Italic\n    const italicMatch = remaining.match(/\\*(.+?)\\*/);\n    // Code\n    const codeMatch = remaining.match(/`([^`]+)`/);\n    // Link\n    const linkMatch = remaining.match(/\\[([^\\]]+)\\]\\(([^)]+)\\)/);\n\n    // Find earliest match\n    const matches = [\n      boldMatch && { type: \"bold\", index: boldMatch.index, match: boldMatch },\n      italicMatch && { type: \"italic\", index: italicMatch.index, match: italicMatch },\n      codeMatch && { type: \"code\", index: codeMatch.index, match: codeMatch },\n      linkMatch && { type: \"link\", index: linkMatch.index, match: linkMatch },\n    ].filter(Boolean);\n\n    if (matches.length === 0) {\n      parts.push(remaining);\n      break;\n    }\n\n    // Prefer bold over italic when at same position\n    matches.sort((a, b) => {\n      if (a.index !== b.index) return a.index - b.index;\n      if (a.type === \"bold\") return -1;\n      if (b.type === \"bold\") return 1;\n      return 0;\n    });\n\n    const first = matches[0];\n    const before = remaining.slice(0, first.index);\n    if (before) parts.push(before);\n\n    if (first.type === \"bold\") {\n      parts.push(<strong key={key++}>{first.match[1]}</strong>);\n      remaining = remaining.slice(first.index + first.match[0].length);\n    } else if (first.type === \"italic\") {\n      parts.push(<em key={key++}>{first.match[1]}</em>);\n      remaining = remaining.slice(first.index + first.match[0].length);\n    } else if (first.type === \"code\") {\n      parts.push(\n        <code key={key++} className=\"text-[12px] bg-[#f4f4f4] px-1 py-0.5 rounded font-mono\">\n          {first.match[1]}\n        </code>\n      );\n      remaining = remaining.slice(first.index + first.match[0].length);\n    } else if (first.type === \"link\") {\n      parts.push(\n        <a key={key++} href={first.match[2]} target=\"_blank\" rel=\"noopener noreferrer\" className=\"underline text-blue-700\">\n          {first.match[1]}\n        </a>\n      );\n      remaining = remaining.slice(first.index + first.match[0].length);\n    }\n  }\n\n  return parts.length === 1 && typeof parts[0] === \"string\" ? parts[0] : <>{parts}</>;\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1503, "column": 0}, "map": {"version":3,"sources":["file:///Users/laphatize/Documents/synthesis/frontend/app/components/PapersSidebar.js"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport PaperModal from \"./PaperModal\";\n\nexport default function PapersSidebar({ papers, loading, query, open, onToggle, userText }) {\n  const [selectedPaper, setSelectedPaper] = useState(null);\n\n  return (\n    <>\n      <aside\n        className={`flex flex-col border-l border-[var(--border)] bg-[var(--surface)] transition-all ${\n          open ? \"w-80\" : \"w-0 overflow-hidden\"\n        }`}\n      >\n        <div className=\"flex items-center justify-between px-4 py-3 border-b border-[var(--border)]\">\n          <div className=\"flex items-center gap-2\">\n            <span className=\"text-xs font-semibold tracking-wide uppercase text-[var(--muted)]\">\n              Papers\n            </span>\n            {loading && <span className=\"papers-loader\" />}\n          </div>\n          <button\n            onClick={onToggle}\n            className=\"text-xs text-[var(--muted)] hover:text-[var(--fg)] transition\"\n          >\n            âœ•\n          </button>\n        </div>\n\n        {query && (\n          <div className=\"px-4 py-2 border-b border-[var(--border)]\">\n            <p className=\"text-[10px] text-[var(--muted)] truncate\">\n              Searching: <span className=\"text-[var(--fg)]\">{query}</span>\n            </p>\n          </div>\n        )}\n\n        <div className=\"flex-1 overflow-y-auto\">\n          {papers.length === 0 && !loading ? (\n            <div className=\"px-4 py-8 text-center\">\n              <p className=\"text-xs text-[var(--muted)]\">\n                {query\n                  ? \"No papers found for this topic.\"\n                  : \"Start writing to discover relevant research papers.\"}\n              </p>\n            </div>\n          ) : (\n            <div className=\"divide-y divide-[var(--border)]\">\n              {papers.map((paper) => (\n                <PaperCard\n                  key={paper.id}\n                  paper={paper}\n                  onClick={() => setSelectedPaper(paper)}\n                />\n              ))}\n            </div>\n          )}\n        </div>\n      </aside>\n\n      {/* Paper detail modal */}\n      {selectedPaper && (\n        <PaperModal\n          paper={selectedPaper}\n          userText={userText}\n          onClose={() => setSelectedPaper(null)}\n        />\n      )}\n    </>\n  );\n}\n\nfunction PaperCard({ paper, onClick }) {\n  return (\n    <div\n      className=\"px-4 py-3 hover:bg-[#fafafa] transition group cursor-pointer\"\n      onClick={onClick}\n    >\n      <h4 className=\"text-xs font-medium leading-snug mb-1 group-hover:text-blue-700 transition\">\n        {paper.title}\n      </h4>\n\n      <p className=\"text-[10px] text-[var(--muted)] mb-1.5 leading-relaxed\">\n        {paper.summaryShort || paper.summary}\n      </p>\n\n      <div className=\"flex items-center gap-2 flex-wrap\">\n        <span className=\"text-[10px] text-[var(--muted)]\">\n          {paper.authors.join(\", \")}\n          {paper.authors.length >= 4 && \" et al.\"}\n        </span>\n        <span className=\"text-[10px] text-[var(--muted)]\">Â·</span>\n        <span className=\"text-[10px] text-[var(--muted)]\">{paper.published}</span>\n      </div>\n\n      <div className=\"flex items-center gap-2 mt-1.5\">\n        {paper.categories.map((cat) => (\n          <span\n            key={cat}\n            className=\"text-[9px] px-1.5 py-0.5 rounded bg-[#f0f0f0] text-[var(--muted)]\"\n          >\n            {cat}\n          </span>\n        ))}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;;;AAHA;;;AAKe,SAAS,cAAc,EAAE,MAAM,EAAE,OAAO,EAAE,KAAK,EAAE,IAAI,EAAE,QAAQ,EAAE,QAAQ,EAAE;;IACxF,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,yKAAQ,EAAC;IAEnD,qBACE;;0BACE,6LAAC;gBACC,WAAW,CAAC,iFAAiF,EAC3F,OAAO,SAAS,uBAChB;;kCAEF,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCAAI,WAAU;;kDACb,6LAAC;wCAAK,WAAU;kDAAoE;;;;;;oCAGnF,yBAAW,6LAAC;wCAAK,WAAU;;;;;;;;;;;;0CAE9B,6LAAC;gCACC,SAAS;gCACT,WAAU;0CACX;;;;;;;;;;;;oBAKF,uBACC,6LAAC;wBAAI,WAAU;kCACb,cAAA,6LAAC;4BAAE,WAAU;;gCAA2C;8CAC3C,6LAAC;oCAAK,WAAU;8CAAoB;;;;;;;;;;;;;;;;;kCAKrD,6LAAC;wBAAI,WAAU;kCACZ,OAAO,MAAM,KAAK,KAAK,CAAC,wBACvB,6LAAC;4BAAI,WAAU;sCACb,cAAA,6LAAC;gCAAE,WAAU;0CACV,QACG,oCACA;;;;;;;;;;iDAIR,6LAAC;4BAAI,WAAU;sCACZ,OAAO,GAAG,CAAC,CAAC,sBACX,6LAAC;oCAEC,OAAO;oCACP,SAAS,IAAM,iBAAiB;mCAF3B,MAAM,EAAE;;;;;;;;;;;;;;;;;;;;;YAWxB,+BACC,6LAAC,6IAAU;gBACT,OAAO;gBACP,UAAU;gBACV,SAAS,IAAM,iBAAiB;;;;;;;;AAK1C;GAlEwB;KAAA;AAoExB,SAAS,UAAU,EAAE,KAAK,EAAE,OAAO,EAAE;IACnC,qBACE,6LAAC;QACC,WAAU;QACV,SAAS;;0BAET,6LAAC;gBAAG,WAAU;0BACX,MAAM,KAAK;;;;;;0BAGd,6LAAC;gBAAE,WAAU;0BACV,MAAM,YAAY,IAAI,MAAM,OAAO;;;;;;0BAGtC,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAK,WAAU;;4BACb,MAAM,OAAO,CAAC,IAAI,CAAC;4BACnB,MAAM,OAAO,CAAC,MAAM,IAAI,KAAK;;;;;;;kCAEhC,6LAAC;wBAAK,WAAU;kCAAkC;;;;;;kCAClD,6LAAC;wBAAK,WAAU;kCAAmC,MAAM,SAAS;;;;;;;;;;;;0BAGpE,6LAAC;gBAAI,WAAU;0BACZ,MAAM,UAAU,CAAC,GAAG,CAAC,CAAC,oBACrB,6LAAC;wBAEC,WAAU;kCAET;uBAHI;;;;;;;;;;;;;;;;AASjB;MAnCS"}},
    {"offset": {"line": 1736, "column": 0}, "map": {"version":3,"sources":["file:///Users/laphatize/Documents/synthesis/frontend/app/components/NewDocModal.js"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport { apiFetch } from \"../lib/api\";\n\nexport default function NewDocModal({ onCreated, onClose, workspaceId, token }) {\n  const [mode, setMode] = useState(null); // null = choosing, \"ai\" = AI form\n  const [topic, setTopic] = useState(\"\");\n  const [generating, setGenerating] = useState(false);\n  const [error, setError] = useState(\"\");\n\n  function handleScratch() {\n    onCreated({ title: \"Untitled\", content: \"\" });\n  }\n\n  async function handleAI(e) {\n    e.preventDefault();\n    if (!topic.trim()) return;\n    setGenerating(true);\n    setError(\"\");\n\n    try {\n      const data = await apiFetch(\n        \"/api/arxiv/generate\",\n        {\n          method: \"POST\",\n          body: JSON.stringify({ topic: topic.trim() }),\n        },\n        token\n      );\n      onCreated({\n        title: data.title || topic.trim(),\n        content: data.content || \"\",\n      });\n    } catch (err) {\n      setError(err.message);\n      setGenerating(false);\n    }\n  }\n\n  return (\n    <div className=\"paper-modal-overlay\" onClick={onClose}>\n      <div\n        className=\"paper-modal\"\n        style={{ maxWidth: 420, maxHeight: \"auto\" }}\n        onClick={(e) => e.stopPropagation()}\n      >\n        {/* Header */}\n        <div className=\"paper-modal-header\">\n          <div className=\"flex-1\">\n            <h2 className=\"text-sm font-semibold\">\n              {mode === \"ai\" ? \"Create with AI\" : \"New document\"}\n            </h2>\n          </div>\n          <button onClick={onClose} className=\"paper-modal-close\">âœ•</button>\n        </div>\n\n        <div style={{ padding: \"1.25rem\" }}>\n          {/* â”€â”€â”€ Mode selection â”€â”€â”€ */}\n          {mode === null && (\n            <div className=\"flex flex-col gap-2\">\n              <button\n                onClick={handleScratch}\n                className=\"new-doc-option\"\n              >\n                <span className=\"new-doc-icon\">âœŽ</span>\n                <div className=\"text-left\">\n                  <p className=\"text-sm font-medium\">From scratch</p>\n                  <p className=\"text-[11px] text-[var(--muted)]\">\n                    Start with a blank document\n                  </p>\n                </div>\n              </button>\n\n              <button\n                onClick={() => setMode(\"ai\")}\n                className=\"new-doc-option\"\n              >\n                <span className=\"new-doc-icon\">âœ¨</span>\n                <div className=\"text-left\">\n                  <p className=\"text-sm font-medium\">With AI</p>\n                  <p className=\"text-[11px] text-[var(--muted)]\">\n                    Generate a starter draft from a topic\n                  </p>\n                </div>\n              </button>\n            </div>\n          )}\n\n          {/* â”€â”€â”€ AI form â”€â”€â”€ */}\n          {mode === \"ai\" && (\n            <form onSubmit={handleAI}>\n              <label className=\"block text-xs text-[var(--muted)] mb-1.5\">\n                What do you want to write about?\n              </label>\n              <input\n                type=\"text\"\n                value={topic}\n                onChange={(e) => setTopic(e.target.value)}\n                placeholder=\"e.g. Transformer architectures for protein folding\"\n                className=\"w-full border-b border-[var(--border)] bg-transparent py-2 text-sm outline-none placeholder:text-[var(--muted)] focus:border-[var(--fg)] mb-3\"\n                autoFocus\n                disabled={generating}\n              />\n\n              {error && (\n                <p className=\"text-[11px] text-red-500 mb-2\">{error}</p>\n              )}\n\n              <div className=\"flex items-center justify-between\">\n                <button\n                  type=\"button\"\n                  onClick={() => { setMode(null); setError(\"\"); }}\n                  className=\"text-xs text-[var(--muted)] hover:text-[var(--fg)] transition\"\n                  disabled={generating}\n                >\n                  â† Back\n                </button>\n                <button\n                  type=\"submit\"\n                  disabled={!topic.trim() || generating}\n                  className=\"text-xs font-medium px-4 py-1.5 rounded bg-[var(--fg)] text-white disabled:opacity-40 transition\"\n                >\n                  {generating ? (\n                    <span className=\"flex items-center gap-1.5\">\n                      <span className=\"papers-loader\" style={{ borderTopColor: \"#fff\", borderColor: \"rgba(255,255,255,0.3)\" }} />\n                      Generatingâ€¦\n                    </span>\n                  ) : (\n                    \"Generate\"\n                  )}\n                </button>\n              </div>\n            </form>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2045, "column": 0}, "map": {"version":3,"sources":["file:///Users/laphatize/Documents/synthesis/frontend/app/dashboard/%5Bid%5D/page.js"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState, useCallback, useRef } from \"react\";\nimport { useAuth } from \"../../lib/auth-context\";\nimport { apiFetch } from \"../../lib/api\";\nimport { useArxivSuggestions } from \"../../lib/use-arxiv\";\nimport { useRouter, useParams } from \"next/navigation\";\nimport Link from \"next/link\";\nimport Editor from \"../../components/Editor\";\nimport PapersSidebar from \"../../components/PapersSidebar\";\nimport NewDocModal from \"../../components/NewDocModal\";\n\nexport default function WorkspacePage() {\n  const { user, token, loading } = useAuth();\n  const router = useRouter();\n  const params = useParams();\n  const workspaceId = params.id;\n\n  const [workspace, setWorkspace] = useState(null);\n  const [items, setItems] = useState([]);\n  const [activeItemId, setActiveItemId] = useState(null);\n  const [loadingWs, setLoadingWs] = useState(true);\n  const [saving, setSaving] = useState(false);\n  const [sidebarOpen, setSidebarOpen] = useState(true);\n  const [papersOpen, setPapersOpen] = useState(true);\n  const [editorText, setEditorText] = useState(\"\");\n  const [showNewDoc, setShowNewDoc] = useState(false);\n\n  const { papers, loading: papersLoading, query: papersQuery } = useArxivSuggestions(editorText);\n\n  useEffect(() => {\n    if (!loading && !user) router.replace(\"/login\");\n  }, [user, loading, router]);\n\n  const loadWorkspace = useCallback(async () => {\n    if (!token || !workspaceId) return;\n    try {\n      const [wsData, itemsData] = await Promise.all([\n        apiFetch(`/api/workspaces/${workspaceId}`, {}, token),\n        apiFetch(`/api/workspaces/${workspaceId}/items`, {}, token),\n      ]);\n      setWorkspace(wsData.workspace);\n      const fetchedItems = itemsData.items || [];\n      setItems(fetchedItems);\n      // Auto-select first doc\n      if (fetchedItems.length && !activeItemId) {\n        setActiveItemId(fetchedItems[0].id);\n      }\n    } catch {\n      // silent\n    } finally {\n      setLoadingWs(false);\n    }\n  }, [token, workspaceId, activeItemId]);\n\n  useEffect(() => { loadWorkspace(); }, [loadWorkspace]);\n\n  const activeItem = items.find((i) => i.id === activeItemId) || null;\n\n  async function handleCreateDoc() {\n    setShowNewDoc(true);\n  }\n\n  async function handleNewDocCreated({ title, content }) {\n    setShowNewDoc(false);\n    try {\n      const data = await apiFetch(\n        `/api/workspaces/${workspaceId}/items`,\n        {\n          method: \"POST\",\n          body: JSON.stringify({\n            type: \"note\",\n            title: title || \"Untitled\",\n            content: content || \"\",\n            autoEmbed: false,\n          }),\n        },\n        token\n      );\n      setItems((prev) => [data.item, ...prev]);\n      setActiveItemId(data.item.id);\n    } catch {\n      // silent\n    }\n  }\n\n  async function handleUpdateContent(html) {\n    if (!activeItemId) return;\n    setSaving(true);\n    // Optimistically update local state\n    setItems((prev) =>\n      prev.map((i) => (i.id === activeItemId ? { ...i, content: html } : i))\n    );\n    try {\n      await apiFetch(\n        `/api/workspaces/${workspaceId}/items/${activeItemId}`,\n        { method: \"PATCH\", body: JSON.stringify({ content: html }) },\n        token\n      );\n    } catch {\n      // silent\n    } finally {\n      setSaving(false);\n    }\n  }\n\n  async function handleRenameItem(itemId, newTitle) {\n    setItems((prev) =>\n      prev.map((i) => (i.id === itemId ? { ...i, title: newTitle } : i))\n    );\n    try {\n      await apiFetch(\n        `/api/workspaces/${workspaceId}/items/${itemId}`,\n        { method: \"PATCH\", body: JSON.stringify({ title: newTitle }) },\n        token\n      );\n    } catch {\n      // silent\n    }\n  }\n\n  async function handleDeleteItem(itemId) {\n    setItems((prev) => prev.filter((i) => i.id !== itemId));\n    if (activeItemId === itemId) {\n      const remaining = items.filter((i) => i.id !== itemId);\n      setActiveItemId(remaining.length ? remaining[0].id : null);\n    }\n    try {\n      await apiFetch(\n        `/api/workspaces/${workspaceId}/items/${itemId}`,\n        { method: \"DELETE\" },\n        token\n      );\n    } catch {\n      // silent\n    }\n  }\n\n  if (loading || !user) return null;\n\n  if (loadingWs) {\n    return (\n      <div className=\"flex min-h-screen items-center justify-center\">\n        <p className=\"text-sm text-[var(--muted)]\">Loadingâ€¦</p>\n      </div>\n    );\n  }\n\n  if (!workspace) {\n    return (\n      <div className=\"flex min-h-screen flex-col items-center justify-center gap-2\">\n        <p className=\"text-sm text-[var(--muted)]\">Workspace not found</p>\n        <Link href=\"/dashboard\" className=\"text-xs underline\">Back</Link>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex h-screen overflow-hidden\">\n      {/* Sidebar */}\n      <aside\n        className={`flex flex-col border-r border-[var(--border)] bg-[var(--surface)] transition-all ${\n          sidebarOpen ? \"w-60\" : \"w-0 overflow-hidden\"\n        }`}\n      >\n        <div className=\"flex items-center justify-between px-4 py-3\">\n          <Link\n            href=\"/dashboard\"\n            className=\"text-xs text-[var(--muted)] transition hover:text-[var(--fg)]\"\n          >\n            â† Back\n          </Link>\n          <button\n            onClick={handleCreateDoc}\n            className=\"text-xs font-medium text-[var(--fg)] transition hover:opacity-60\"\n          >\n            + New\n          </button>\n        </div>\n\n        <div className=\"px-4 pb-2\">\n          <p className=\"truncate text-sm font-medium\">{workspace.name}</p>\n        </div>\n\n        <nav className=\"flex-1 overflow-y-auto\">\n          {items.length === 0 ? (\n            <p className=\"px-4 py-6 text-center text-xs text-[var(--muted)]\">\n              No docs yet\n            </p>\n          ) : (\n            items.map((item) => (\n              <SidebarItem\n                key={item.id}\n                item={item}\n                active={item.id === activeItemId}\n                onSelect={() => setActiveItemId(item.id)}\n                onRename={(title) => handleRenameItem(item.id, title)}\n                onDelete={() => handleDeleteItem(item.id)}\n              />\n            ))\n          )}\n        </nav>\n      </aside>\n\n      {/* Main */}\n      <main className=\"flex flex-1 flex-col overflow-hidden\">\n        {/* Top bar */}\n        <div className=\"flex items-center justify-between border-b border-[var(--border)] px-4 py-2\">\n          <div className=\"flex items-center gap-3\">\n            <button\n              onClick={() => setSidebarOpen(!sidebarOpen)}\n              className=\"text-xs text-[var(--muted)] transition hover:text-[var(--fg)]\"\n            >\n              {sidebarOpen ? \"â—\" : \"â–·\"}\n            </button>\n            {activeItem && (\n              <span className=\"text-sm font-medium\">{activeItem.title || \"Untitled\"}</span>\n            )}\n          </div>\n          <div className=\"flex items-center gap-3\">\n            {saving && (\n              <span className=\"text-[10px] text-[var(--muted)]\">Savingâ€¦</span>\n            )}\n            <button\n              onClick={() => setPapersOpen(!papersOpen)}\n              className={`text-xs transition ${\n                papersOpen ? \"text-[var(--fg)]\" : \"text-[var(--muted)] hover:text-[var(--fg)]\"\n              }`}\n              title=\"Toggle research papers\"\n            >\n              ðŸ“„ Papers\n            </button>\n          </div>\n        </div>\n\n        {/* Editor */}\n        {activeItem ? (\n          <Editor\n            key={activeItemId}\n            content={activeItem.content || \"\"}\n            onUpdate={handleUpdateContent}\n            onTextChange={setEditorText}\n            placeholder=\"Start writingâ€¦\"\n          />\n        ) : (\n          <div className=\"flex flex-1 items-center justify-center\">\n            <div className=\"text-center\">\n              <p className=\"text-sm text-[var(--muted)]\">\n                {items.length === 0\n                  ? \"Create a doc to get started\"\n                  : \"Select a doc from the sidebar\"}\n              </p>\n              {items.length === 0 && (\n                <button\n                  onClick={handleCreateDoc}\n                  className=\"mt-3 rounded-lg bg-[var(--fg)] px-4 py-2 text-xs font-medium text-white transition hover:opacity-80\"\n                >\n                  New doc\n                </button>\n              )}\n            </div>\n          </div>\n        )}\n      </main>\n\n      {/* Research papers sidebar */}\n      <PapersSidebar\n        papers={papers}\n        loading={papersLoading}\n        query={papersQuery}\n        open={papersOpen}\n        onToggle={() => setPapersOpen(false)}\n        userText={editorText}\n      />\n\n      {/* New doc modal */}\n      {showNewDoc && (\n        <NewDocModal\n          workspaceId={workspaceId}\n          token={token}\n          onCreated={handleNewDocCreated}\n          onClose={() => setShowNewDoc(false)}\n        />\n      )}\n    </div>\n  );\n}\n\nfunction SidebarItem({ item, active, onSelect, onRename, onDelete }) {\n  const [editing, setEditing] = useState(false);\n  const [title, setTitle] = useState(item.title || \"Untitled\");\n  const inputRef = useRef(null);\n\n  useEffect(() => {\n    if (editing && inputRef.current) {\n      inputRef.current.focus();\n      inputRef.current.select();\n    }\n  }, [editing]);\n\n  function commitRename() {\n    setEditing(false);\n    const trimmed = title.trim() || \"Untitled\";\n    setTitle(trimmed);\n    if (trimmed !== item.title) onRename(trimmed);\n  }\n\n  return (\n    <div\n      className={`group flex items-center gap-1 px-4 py-1.5 text-sm transition cursor-pointer ${\n        active ? \"bg-[#f0f0f0] font-medium\" : \"text-[var(--muted)] hover:bg-[#f8f8f8]\"\n      }`}\n      onClick={onSelect}\n    >\n      {editing ? (\n        <input\n          ref={inputRef}\n          value={title}\n          onChange={(e) => setTitle(e.target.value)}\n          onBlur={commitRename}\n          onKeyDown={(e) => {\n            if (e.key === \"Enter\") commitRename();\n            if (e.key === \"Escape\") { setTitle(item.title || \"Untitled\"); setEditing(false); }\n          }}\n          onClick={(e) => e.stopPropagation()}\n          className=\"flex-1 bg-transparent text-sm outline-none\"\n        />\n      ) : (\n        <span className=\"flex-1 truncate\">{item.title || \"Untitled\"}</span>\n      )}\n\n      <div className=\"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition\">\n        <button\n          onClick={(e) => { e.stopPropagation(); setEditing(true); }}\n          className=\"text-[10px] text-[var(--muted)] hover:text-[var(--fg)]\"\n          title=\"Rename\"\n        >\n          âœŽ\n        </button>\n        <button\n          onClick={(e) => { e.stopPropagation(); onDelete(); }}\n          className=\"text-[10px] text-[var(--muted)] hover:text-red-500\"\n          title=\"Delete\"\n        >\n          âœ•\n        </button>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}